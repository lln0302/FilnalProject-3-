<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.campus.myapp.gather.GatherDAO">
	<insert id="gatherInsert">
		INSERT INTO gather(nickname, title, content, place, gmemberno, startdate, enddate)
		VALUES(#{nickname}, #{title}, #{content}, #{place}, #{gmemberno},
		STR_TO_DATE(#{startdate}, '%Y-%m-%d'),  STR_TO_DATE(#{enddate}, '%Y-%m-%d'))
	</insert>
	<select id="gatherList" resultType="GatherVO">
		SELECT gatherno, title, place, views, nickname,
		date_format(startdate, "%Y-%m-%d") startdate,
		date_format(enddate, "%Y-%m-%d") enddate,
		date_format(createdate, "%y-%m-%d %H:%i") createdate,
		content, gmemberno, gnewno 
		FROM gather ORDER BY gatherno DESC
		LIMIT ${param1.postsPerPage} OFFSET ${param1.offset}
	</select>
	<select id="selectTotalPosts" resultType="int">
		SELECT count(gatherno)count FROM gather
	</select>
	<select id="gatherView" resultType="GatherVO">
		SELECT gatherno, title, place, views, nickname,
		date_format(startdate, "%Y-%m-%d") startdate,
		date_format(enddate, "%Y-%m-%d") enddate,
		date_format(createdate, "%y-%m-%d %H:%i") createdate,
		content, gmemberno, gnewno
		FROM gather WHERE gatherno=#{param1}
	</select>
	<update id="updateViews">
		update gather set views=views+1 where gatherno=#{param1}
	</update>
</mapper>